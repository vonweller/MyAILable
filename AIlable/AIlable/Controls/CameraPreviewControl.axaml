<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="using:AIlable.Controls"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="300"
             x:Class="AIlable.Controls.CameraPreviewControl"
             x:DataType="controls:CameraPreviewControl">

  <UserControl.Styles>
    <Style Selector="Border.camera-preview">
      <Setter Property="Background" Value="#1A1A1A" />
      <Setter Property="BorderBrush" Value="#404040" />
      <Setter Property="BorderThickness" Value="2" />
      <Setter Property="CornerRadius" Value="8" />
    </Style>
    
    <Style Selector="TextBlock.camera-info">
      <Setter Property="Foreground" Value="#CCCCCC" />
      <Setter Property="FontSize" Value="12" />
      <Setter Property="HorizontalAlignment" Value="Center" />
      <Setter Property="VerticalAlignment" Value="Center" />
    </Style>
    
    <Style Selector="Button.camera-control">
      <Setter Property="Background" Value="#2196F3" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderBrush" Value="Transparent" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="Padding" Value="12,8" />
      <Setter Property="Margin" Value="4" />
    </Style>
    
    <Style Selector="Button.camera-control:pointerover">
      <Setter Property="Background" Value="#1976D2" />
    </Style>
    
    <Style Selector="Button.camera-control:pressed">
      <Setter Property="Background" Value="#1565C0" />
    </Style>

    <Style Selector="Button.capture-button">
      <Setter Property="Background" Value="#4CAF50" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderBrush" Value="Transparent" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="CornerRadius" Value="20" />
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="FontSize" Value="14" />
      <Setter Property="Padding" Value="16,12" />
      <Setter Property="Margin" Value="8" />
    </Style>
    
    <Style Selector="Button.capture-button:pointerover">
      <Setter Property="Background" Value="#43A047" />
    </Style>
  </UserControl.Styles>

  <Border Classes="camera-preview">
    <Grid>
      <!-- 摄像头预览区域 -->
      <Image x:Name="PreviewImage"
             Stretch="Uniform"
             StretchDirection="Both"
             IsVisible="{Binding IsPreviewActive}" />
      
      <!-- 无预览时的提示 -->
      <StackPanel VerticalAlignment="Center" 
                  HorizontalAlignment="Center"
                  IsVisible="{Binding !IsPreviewActive}">
        <Ellipse Width="60" Height="60"
                 Fill="#404040"
                 Margin="0,0,0,16" />
        <TextBlock Text="📷"
                   FontSize="24"
                   HorizontalAlignment="Center"
                   Margin="0,-44,0,24"
                   Foreground="#888888" />
        <TextBlock Text="摄像头预览"
                   Classes="camera-info"
                   Margin="0,0,0,8" />
        <TextBlock Text="点击开启摄像头开始预览"
                   Classes="camera-info"
                   FontSize="10"
                   Foreground="#888888" />
      </StackPanel>
      
      <!-- 控制层 - 悬浮在预览上方 -->
      <Grid VerticalAlignment="Bottom"
            Margin="12"
            IsVisible="False">
        <!-- 注释：控制层已隐藏，避免挡住预览画面 -->
        <!-- 可以通过右键菜单或快捷键来捕获图像 -->
        <Border Background="#AA000000"
                CornerRadius="8"
                Padding="12,8">
          <StackPanel Orientation="Horizontal"
                      HorizontalAlignment="Center"
                      Spacing="8">
            <!-- 捕获按钮 -->
            <Button x:Name="CaptureButton"
                    Content="📸 捕获 (空格)"
                    Classes="capture-button"
                    Click="OnCaptureClick"
                    ToolTip.Tip="点击或按空格键捕获图像" />
            
            <!-- 状态信息 -->
            <TextBlock Text="{Binding StatusText}"
                       Foreground="White"
                       FontSize="11"
                       VerticalAlignment="Center"
                       Margin="8,0" />
          </StackPanel>
        </Border>
      </Grid>
      
      <!-- 加载指示器 -->
      <Border Background="#AA000000"
              CornerRadius="8"
              Padding="16"
              HorizontalAlignment="Center"
              VerticalAlignment="Center"
              IsVisible="{Binding IsLoading}">
        <StackPanel Orientation="Horizontal" Spacing="8">
          <Border Width="16" Height="16"
                  Background="#2196F3"
                  CornerRadius="8">
            <Border.Styles>
              <Style Selector="Border">
                <Style.Animations>
                  <Animation Duration="0:0:1" IterationCount="INFINITE">
                    <KeyFrame Cue="0%">
                      <Setter Property="Opacity" Value="0.5" />
                    </KeyFrame>
                    <KeyFrame Cue="50%">
                      <Setter Property="Opacity" Value="1" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                      <Setter Property="Opacity" Value="0.5" />
                    </KeyFrame>
                  </Animation>
                </Style.Animations>
              </Style>
            </Border.Styles>
          </Border>
          <TextBlock Text="正在加载..."
                     Foreground="White"
                     FontSize="12"
                     VerticalAlignment="Center" />
        </StackPanel>
      </Border>
    </Grid>
  </Border>
</UserControl>