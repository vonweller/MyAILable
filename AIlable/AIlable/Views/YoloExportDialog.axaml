<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AIlable.ViewModels"
        x:Class="AIlable.Views.YoloExportDialog"
        x:DataType="vm:YoloExportDialogViewModel"
        Title="YOLO å¯¼å‡ºè®¾ç½®"
        Width="600"
        Height="700"
        MinWidth="550"
        MinHeight="650"
        WindowStartupLocation="CenterOwner"
        CanResize="true">

  <Design.DataContext>
    <vm:YoloExportDialogViewModel />
  </Design.DataContext>

  <Grid Margin="24">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- æ ‡é¢˜ -->
    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,24">
      <TextBlock Text="ðŸŽ¯" FontSize="28" Margin="0,0,12,0" VerticalAlignment="Center" />
      <TextBlock Text="YOLO å¯¼å‡ºé…ç½®" FontSize="20" FontWeight="Bold" VerticalAlignment="Center" />
    </StackPanel>

    <!-- ä¸»è¦å†…å®¹ -->
    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
      <StackPanel Spacing="20">
        
        <!-- æ ¼å¼é€‰æ‹© -->
        <Border Background="White" BorderBrush="#E1E8ED" BorderThickness="1" CornerRadius="12" Padding="20">
          <StackPanel Spacing="16">
            <TextBlock Text="ðŸ“‹ å¯¼å‡ºæ ¼å¼é€‰æ‹©" FontSize="16" FontWeight="SemiBold" />
            
            <StackPanel Spacing="12">
              <RadioButton Content="åˆ†å‰²æ ¼å¼ (Segmentation)" 
                           IsChecked="{Binding UseSegmentationFormat}" 
                           FontWeight="SemiBold" />
              <RadioButton Content="æ£€æµ‹æ ¼å¼ (Detection)" 
                           IsChecked="{Binding !UseSegmentationFormat}" 
                           FontWeight="SemiBold" />
            </StackPanel>
            
            <!-- æ ¼å¼è¯´æ˜Ž -->
            <Border Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="8" Padding="16">
              <TextBlock Text="{Binding FormatDescription}" 
                         TextWrapping="Wrap" 
                         LineHeight="20"
                         FontSize="13" />
            </Border>
          </StackPanel>
        </Border>

        <!-- æ ‡æ³¨ç»Ÿè®¡ -->
        <Border Background="White" BorderBrush="#E1E8ED" BorderThickness="1" CornerRadius="12" Padding="20"
                IsVisible="{Binding AnnotationTypes.Count}">
          <StackPanel Spacing="16">
            <TextBlock Text="ðŸ“Š é¡¹ç›®æ ‡æ³¨ç»Ÿè®¡" FontSize="16" FontWeight="SemiBold" />
            
            <ItemsControl ItemsSource="{Binding TypeStatistics}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border Background="#F8F9FA" CornerRadius="6" Padding="12,8" Margin="0,4">
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                      </Grid.ColumnDefinitions>
                      <TextBlock Grid.Column="0" Text="{Binding Key}" FontWeight="SemiBold" />
                      <Border Grid.Column="1" Background="#007ACC" CornerRadius="12" Padding="8,4">
                        <TextBlock Text="{Binding Value}" Foreground="White" FontSize="12" />
                      </Border>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Border>

        <!-- æ™ºèƒ½å»ºè®® -->
        <Border Background="#E7F3FF" BorderBrush="#B3D9FF" BorderThickness="1" CornerRadius="12" Padding="20">
          <StackPanel Spacing="12">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <TextBlock Text="ðŸ’¡" FontSize="16" />
              <TextBlock Text="æ™ºèƒ½å»ºè®®" FontSize="16" FontWeight="SemiBold" />
            </StackPanel>
            <TextBlock Text="{Binding Recommendation}"
                       TextWrapping="Wrap"
                       LineHeight="20"
                       FontSize="13" />
          </StackPanel>
        </Border>

        <!-- å¯¼å‡ºé€‰é¡¹ -->
        <Border Background="White" BorderBrush="#E1E8ED" BorderThickness="1" CornerRadius="12" Padding="20">
          <StackPanel Spacing="16">
            <TextBlock Text="âš™ï¸ å¯¼å‡ºé€‰é¡¹" FontSize="16" FontWeight="SemiBold" />
            
            <StackPanel Spacing="12">
              <CheckBox Content="åŒ…å«å›¾åƒæ–‡ä»¶" IsChecked="{Binding IncludeImages}" />
              <CheckBox Content="åˆ†å‰²è®­ç»ƒ/éªŒè¯é›†" IsChecked="{Binding SplitTrainVal}" />
              
              <StackPanel IsVisible="{Binding SplitTrainVal}" Spacing="8">
                <TextBlock Text="è®­ç»ƒé›†æ¯”ä¾‹:" FontSize="13" />
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <Slider Value="{Binding TrainRatio}" 
                          Minimum="0.1" Maximum="0.9" 
                          Width="200" />
                  <TextBlock Text="{Binding TrainRatio, StringFormat='{}{0:P0}'}" 
                             FontWeight="SemiBold" 
                             VerticalAlignment="Center" />
                </StackPanel>
              </StackPanel>
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- è¾“å‡ºè·¯å¾„ -->
        <Border Background="White" BorderBrush="#E1E8ED" BorderThickness="1" CornerRadius="12" Padding="20">
          <StackPanel Spacing="16">
            <TextBlock Text="ðŸ“ è¾“å‡ºè·¯å¾„" FontSize="16" FontWeight="SemiBold" />
            
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              
              <TextBox Grid.Column="0" 
                       Text="{Binding OutputPath}" 
                       Watermark="é€‰æ‹©å¯¼å‡ºç›®å½•..." 
                       IsReadOnly="True" 
                       Margin="0,0,12,0" />
              
              <Button Grid.Column="1" 
                      Content="æµè§ˆ..." 
                      Click="OnBrowseClick" 
                      Padding="16,8" />
            </Grid>
          </StackPanel>
        </Border>

      </StackPanel>
    </ScrollViewer>

    <!-- æŒ‰é’® -->
    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12" Margin="0,24,0,0">
      <Button Content="å–æ¶ˆ" 
              Click="OnCancelClick" 
              Padding="20,10" 
              MinWidth="100" />
      <Button Content="å¯¼å‡º" 
              Click="OnExportClick" 
              Classes="accent" 
              Padding="20,10" 
              MinWidth="100"
              IsEnabled="{Binding OutputPath}" />
    </StackPanel>

  </Grid>
</Window>
